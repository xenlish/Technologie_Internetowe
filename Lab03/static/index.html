<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8">
  <title>Blog – lista postów</title>
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>
<div class="container">
  <h1>Blog – lista postów</h1>

  <div class="section">
    <div class="section-title">Dodaj nowy post</div>
    <input id="title" type="text" placeholder="Tytuł">
    <textarea id="body" rows="4" placeholder="Treść posta"></textarea>
    <button id="add-post">Dodaj post</button>
    <div id="add-post-msg" class="small"></div>
  </div>

  <div class="section">
    <div class="section-title">Posty</div>
    <div id="posts"></div>
  </div>
</div>

<script>
async function loadPosts() {
  const res = await fetch('/api/posts');
  const posts = await res.json();
  const container = document.getElementById('posts');
  container.innerHTML = '';
  posts.forEach(p => {
    const div = document.createElement('div');
    div.className = 'post-card';
    const dateObj = new Date(p.created_at);
    const formattedDate = isNaN(dateObj)
  ? p.created_at
  : dateObj.toLocaleString('pl-PL', {
      year: 'numeric',
      month: '2-digit',
      day: '2-digit',
      hour: '2-digit',
      minute: '2-digit',
      second: '2-digit'
    });

div.innerHTML = `
  <strong>${p.title}</strong><br>
  <span class="small">${formattedDate}</span><br>
  <p>${p.body}</p>
  <a class="link" href="/posts/${p.id}">Zobacz szczegóły i komentarze</a>
`;

    container.appendChild(div);
  });
}

document.getElementById('add-post').addEventListener('click', async () => {
  const title = document.getElementById('title').value;
  const body = document.getElementById('body').value;
  const msg = document.getElementById('add-post-msg');
  msg.textContent = '';

  const res = await fetch('/api/posts', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({title, body})
  });

  if (res.ok) {
    document.getElementById('title').value = '';
    document.getElementById('body').value = '';
    msg.textContent = 'Post dodany.';
    loadPosts();
  } else {
    const data = await res.json();
    msg.textContent = 'Błąd: ' + (data.error || res.status);
  }
});

loadPosts();
</script>
</body>
</html>
